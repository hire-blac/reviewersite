<div class="border rounded-3 bg-white my-3 p-3">

  <div class="">
    <small >
        <a class="text-decoration-none" href="/profile/{{review.user.id}}">{{review.user}}</a> reviewed 
        <a class="" href="/product/{{review.product.id}}">{{review.product}}</a>
    </small>
  </div>

  <div class="ms-4 me-2 review">

    <div class="my-2">

      {% load my_filters %}

      {% for i in review.rating|stars %}
        <i class="bi bi-star-fill text-warning"></i>
      {% endfor %}
    </div>
    
    <p class="review-body">
      <a class="text-dark text-decoration-none" href="/review/{{review.id}}">{{review}}</a>
    </p>
  
    <div class="vote d-flex w-75 justify-content-between align-items-center">
      
      <div class="d-inline-block">
        <a class="nav-link comment">
          <i class="bi bi-chat me-3"></i>
            {{review.comment.all|comment_count}}
        </a>
        
      </div>
  
      <div class="d-inline-block">
        <form class="" action="{% url 'upvote' %}" method="POST">
          {% csrf_token %}
          <input type="hidden" name="review_id" value="{{review.id}}">
          <small>
            {% if user not in review.upvotes.all %}
            <button class="upvote text-muted">
              <i class="bi bi-chevron-up me-3"></i>
              {{review.num_upvotes|vote_count}}
            </button>
            {% else %}
            <button class="upvote text-primary">
              <i class="bi bi-chevron-up me-3"></i>
              {{review.num_upvotes|vote_count}}
            </button>
            {% endif %}
          </small>
        </form>
      </div>
      
      <div class="d-inline-block">
        <form class="" action="{% url 'downvote' %}" method="POST">
          {% csrf_token %}
          <input type="hidden" name="review_id" value="{{review.id}}">
          <small>
            {% if user not in review.downvotes.all %}
            <button class="downvote text-muted">
              <i class="bi bi-chevron-down me-3"></i>
              {{review.num_downvotes|vote_count}}
            </button>
            {% else %}
              <button class="downvote text-danger">
                <i class="bi bi-chevron-down me-3"></i>
                {{review.num_downvotes|vote_count}}
              </button>
            {% endif %}
          </small>
        </form>
      </div>
  
      <div class="d-inline-block">
        <a href="" class="nav-link d-inline-block">
          <i class="bi bi-share"></i>
        </a>
      </div>
    </div>

    <div class="comment-box">
      <form class="comment-form bg-transparent border-0" action="/review/comment" method='post'>
        {% csrf_token %}
    
        <input 
          type="text"
          name="review"
          value="{{review.id}}"
          hidden=true  
        >
        {{comment_form.as_p}}
    
        <button class="btn btn-primary">post</button>
        
      </form>
    </div>

  </div>

</div>

<!-- Modal -->
<div class="modal fade" id="commentModal" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="commentModalLabel">Write a comment</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <form class="form-control border-0 p-3" action="/review/comment" method='post'>
          {% csrf_token %}
      
          <input 
            type="text"
            name="review"
            value="{{review.id}}"
            hidden=true  
          >
          {{comment_form.as_p}}
      
          <button class="btn btn-primary">post</button>
          
        </form>
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>
